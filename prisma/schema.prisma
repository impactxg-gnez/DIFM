generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Valid Roles: CUSTOMER, PROVIDER, ADMIN
// Valid Categories: CLEANING, PEST_CONTROL, ELECTRICIAN, PLUMBER, CARPENTER, PAINTER, PC_REPAIR
// Valid JobStatuses: CREATED, DISPATCHING, ACCEPTED, IN_PROGRESS, COMPLETED, CANCELLED_FREE, CANCELLED_CHARGED, CLOSED

model User {
  id              String   @id @default(uuid())
  email           String   @unique
  name            String
  passwordHash    String
  role            String   @default("CUSTOMER")
  
  // Provider specific
  isOnline        Boolean  @default(false)
  categories      String?  // Comma-separated list of categories (SQLite workaround for String[])
  latitude        Float?
  longitude       Float?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  jobsCreated     Job[]    @relation("CustomerJobs")
  jobsAssigned    Job[]    @relation("ProviderJobs")
  
  // Financials
  transactions    Transaction[]
}

model Job {
  id          String    @id @default(uuid())
  description String
  location    String    // Human readable address
  
  // Job Specifics
  category    String    // One of the valid categories
  fixedPrice  Float
  isASAP      Boolean   @default(true)
  scheduledAt DateTime? // If not ASAP
  
  status      String    @default("CREATED")
  dispatchRadius Int    @default(5) // In km, expands over time
  
  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  acceptedAt  DateTime?
  
  // Cancellation
  cancellationReason String?
  
  // Relations
  customerId  String
  customer    User      @relation("CustomerJobs", fields: [customerId], references: [id])
  
  providerId  String?
  provider    User?     @relation("ProviderJobs", fields: [providerId], references: [id])

  transactions Transaction[]
}

model Transaction {
  id        String   @id @default(uuid())
  amount    Float
  type      String   // PAYOUT, CHARGE, FEE
  status    String   // PENDING, COMPLETED, FAILED
  
  jobId     String
  job       Job      @relation(fields: [jobId], references: [id])
  
  userId    String?  // Who is this transaction for (e.g. Provider for Payout, Customer for Charge)
  user      User?    @relation(fields: [userId], references: [id])
  
  createdAt DateTime @default(now())
}
